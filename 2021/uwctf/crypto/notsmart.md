# crypto / notsmart

> Points: 500

## Question

> People say I'm not smart for using non-standard curves.
> Little do they know, with this curve my friend gave me I have 512-bit security!
> Beat that with your standards.

### Provided Files

- [`params.txt`](./params.txt)

## Solution

This is an elliptic curve.
Googling the syntax in `params.txt` turns up Sage,
a Python preprocessor for doing math.

Following the trend of the RSA challenges,
we searched for weaknesses in elliptic curve cryptography.
We found a [paper](https://wstein.org/edu/2010/414/projects/novotney.pdf)
which explained that curves with "insufficiently large prime subgroups"
and "Frobenius trace of 1" are weak.
Whatever that means.
One of the attacks, the one for the case where the trace is 1,
is called "Smart's attack". This lines up with the challenge name.

We tried to use the code from the paper's implementation of Smart's Attack,
but it didn't work. While troubleshooting, we found a
[StackExchange post](https://crypto.stackexchange.com/questions/70454/why-smarts-attack-doesnt-work-on-this-ecdlphttps://crypto.stackexchange.com/questions/70454/why-smarts-attack-doesnt-work-on-this-ecdlp)
which gave another sample implementation.
That one worked.

```py
def SmartAttack(P,Q,p):
    E = P.curve()
    Eqp = EllipticCurve(Qp(p, 2), [ ZZ(t) + randint(0,p)*p for t in E.a_invariants() ])

    P_Qps = Eqp.lift_x(ZZ(P.xy()[0]), all=True)
    for P_Qp in P_Qps:
        if GF(p)(P_Qp.xy()[1]) == P.xy()[1]:
            break

    Q_Qps = Eqp.lift_x(ZZ(Q.xy()[0]), all=True)
    for Q_Qp in Q_Qps:
        if GF(p)(Q_Qp.xy()[1]) == Q.xy()[1]:
            break

    p_times_P = p*P_Qp
    p_times_Q = p*Q_Qp

    x_P,y_P = p_times_P.xy()
    x_Q,y_Q = p_times_Q.xy()

    phi_P = -(x_P/y_P)
    phi_Q = -(x_Q/y_Q)
    k = phi_Q/phi_P
    return ZZ(k)

p = 22701551057777163435329106452462253300519206266871181220523644426479283525153103697143453056508517522156334590460167605011791375057939991397346729300364460419870366131419819135121628268592009564797058723678135184980450327369911011398820109844956572188392009588460408072088507867684982673021153063107451105373877
a = 22701551057777163435329106452462253300519206266871181220523644426479283525153103697143453056508517522156334590460167605011791375057939991397346729300364460419870366131419819135121628268592009564797058723678135184980450327369911011398820109844956572188392009588460408072088507660907303564693124362913431892061877
b = 36191251243309190333816863458093815778056469479424000

E = EllipticCurve(GF(p), [a, b])

P = E([14539340953407309447128097622600966767695971644341149613352685642037475313537977653013196287937042838925142703336131026326692072974971843901390371443083445429399919589784370842720126865620934961358175732489469380486339750131074837129725233595897584785340903613971704420211038266881200486169561222964163237314712, 12220981033341314845042662497041626264460083854715349009530928146129309921830255682888900079439276164704817329835822928364985509779429523824149406629506902556377380013063538163937093075130406701359992059467711208833680051908195481399744411802429801959122303693113403241613393913453282336742515986278719911023623])
Q = E([6643977103923593234721317857839640822924464564202224967131327231011310718952236154003195723885197434593143330675222518291813154315218396475036045594030797021565680208043263852417281571629642896828940259369612239606319130664863735911889411684390983070430929619603194313900928904568674172286274542290168257619021, 2662675294426989411695730689044096924110106396214862039025218934715509457119600340241947634060062437572957382288570132062310003957626059172505037843246743679070435052456630619718576039211102468101861910208628370103455528626569988153904547408080337535510340508307397085265426083434478005064963218646123482647123])

m = SmartAttack(P,Q,p)
print(bytearray.fromhex(hex(m)[2:]).decode())
```

### Flag

`uwctf{now_you_are_smart_7fda03375c279459}`
